<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fundamental Stock Analysis System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab.active {
            color: #667eea;
            background: white;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            font-size: 0.95em;
        }

        .form-group input {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input:disabled {
            background: #e9ecef;
            cursor: not-allowed;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .button-group {
            text-align: center;
            margin-top: 30px;
        }

        .results-container {
            margin-top: 30px;
            display: none;
        }

        .results-container.show {
            display: block;
        }

        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .score-value {
            font-size: 5em;
            font-weight: bold;
            margin: 20px 0;
        }

        .score-rating {
            font-size: 2em;
            margin: 10px 0;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .metric-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }

        .metric-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
            transform: translateY(-3px);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-name {
            font-weight: 600;
            color: #495057;
            font-size: 1.1em;
        }

        .metric-score {
            font-size: 1.5em;
            font-weight: bold;
            padding: 5px 15px;
            border-radius: 20px;
        }

        .score-excellent {
            background: #28a745;
            color: white;
        }

        .score-good {
            background: #17a2b8;
            color: white;
        }

        .score-average {
            background: #ffc107;
            color: #333;
        }

        .score-poor {
            background: #dc3545;
            color: white;
        }

        .metric-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
            font-size: 0.9em;
        }

        .metric-detail {
            display: flex;
            flex-direction: column;
        }

        .metric-detail-label {
            color: #6c757d;
            font-size: 0.85em;
            margin-bottom: 3px;
        }

        .metric-detail-value {
            font-weight: 600;
            color: #495057;
        }

        .category-breakdown {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .category-breakdown h3 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .category-name {
            font-weight: 600;
            color: #495057;
        }

        .category-score {
            font-weight: bold;
            font-size: 1.2em;
            color: #667eea;
        }

        .progress-bar {
            height: 10px;
            background: #dee2e6;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .template-selector {
            margin-bottom: 30px;
        }

        .template-btn {
            padding: 12px 25px;
            margin: 5px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .template-btn:hover {
            background: #667eea;
            color: white;
        }

        .export-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .form-grid,
            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }
        }

        .quick-fill {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .quick-fill h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .help-text {
            font-size: 0.85em;
            color: #6c757d;
            margin-top: 5px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Fundamental Stock Analysis System</h1>
            <p>Professional-Grade Stock Scoring for Indian Markets</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Analyze any company with 14 fundamental metrics across 5 categories</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('input')">üìù Input Data</div>
            <div class="tab" onclick="switchTab('results')">üìä Results</div>
            <div class="tab" onclick="switchTab('guide')">üìñ Guide</div>
        </div>

        <!-- INPUT TAB -->
        <div id="input-tab" class="tab-content active">
            <div class="quick-fill">
                <h4>üöÄ Quick Start Templates</h4>
                <button class="template-btn" onclick="loadTemplate('eternal')">Load Eternal Ltd (Zomato) Data</button>
                <button class="template-btn" onclick="clearAll()">Clear All Fields</button>
            </div>

            <!-- Company Information -->
            <div class="form-section">
                <h3>üè¢ Company Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Company Name *</label>
                        <input type="text" id="company_name" placeholder="e.g., Eternal Ltd">
                    </div>
                    <div class="form-group">
                        <label>Stock Symbol *</label>
                        <input type="text" id="symbol" placeholder="e.g., ETERNAL">
                    </div>
                    <div class="form-group">
                        <label>Current Price (Rs.) *</label>
                        <input type="number" step="0.01" id="current_price" placeholder="e.g., 310.00">
                    </div>
                    <div class="form-group">
                        <label>Sector</label>
                        <input type="text" id="sector" placeholder="e.g., Consumer Services">
                    </div>
                </div>
            </div>

            <!-- Financial Health Metrics -->
            <div class="form-section">
                <h3>üí™ Financial Health Metrics (20% Weight)</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Total Debt (Rs. Crores) *</label>
                        <input type="number" step="0.01" id="total_debt" placeholder="e.g., 248">
                        <span class="help-text">Short-term + Long-term debt</span>
                    </div>
                    <div class="form-group">
                        <label>Shareholders Equity (Rs. Crores) *</label>
                        <input type="number" step="0.01" id="equity" placeholder="e.g., 35820">
                        <span class="help-text">Total shareholders' equity</span>
                    </div>
                    <div class="form-group">
                        <label>Debt-to-Equity Ratio</label>
                        <input type="number" step="0.01" id="debt_equity" disabled>
                        <span class="help-text">Auto-calculated</span>
                    </div>
                    <div class="form-group">
                        <label>Current Assets (Rs. Crores) *</label>
                        <input type="number" step="0.01" id="current_assets" placeholder="e.g., 36293">
                    </div>
                    <div class="form-group">
                        <label>Current Liabilities (Rs. Crores) *</label>
                        <input type="number" step="0.01" id="current_liabilities" placeholder="e.g., 1785">
                    </div>
                    <div class="form-group">
                        <label>Current Ratio</label>
                        <input type="number" step="0.01" id="current_ratio" disabled>
                        <span class="help-text">Auto-calculated</span>
                    </div>
                    <div class="form-group">
                        <label>EBIT (Rs. Crores) *</label>
                        <input type="number" step="0.01" id="ebit" placeholder="e.g., 1297">
                        <span class="help-text">Operating income</span>
                    </div>
                    <div class="form-group">
                        <label>Interest Expense (Rs. Crores) *</label>
                        <input type="number" step="0.01" id="interest" placeholder="e.g., 20">
                    </div>
                    <div class="form-group">
                        <label>Interest Coverage Ratio</label>
                        <input type="number" step="0.01" id="interest_coverage" disabled>
                        <span class="help-text">Auto-calculated</span>
                    </div>
                </div>
            </div>

            <!-- Profitability Metrics -->
            <div class="form-section">
                <h3>üí∞ Profitability Metrics (25% Weight)</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Net Income (Rs. Crores) *</label>
                        <input type="number" step="0.01" id="net_income" placeholder="e.g., 2362">
                    </div>
                    <div class="form-group">
                        <label>Return on Equity (ROE %) *</label>
                        <input type="number" step="0.01" id="roe" placeholder="e.g., 6.75">
                        <span class="help-text">Net Income / Avg Equity √ó 100</span>
                    </div>
                    <div class="form-group">
                        <label>Return on Invested Capital (ROIC %) *</label>
                        <input type="number" step="0.01" id="roic" placeholder="e.g., 13.00">
                    </div>
                    <div class="form-group">
                        <label>Total Revenue (Rs. Crores) *</label>
                        <input type="number" step="0.01" id="revenue" placeholder="e.g., 9481">
                    </div>
                    <div class="form-group">
                        <label>Net Profit Margin (%)</label>
                        <input type="number" step="0.01" id="net_margin" disabled>
                        <span class="help-text">Auto-calculated</span>
                    </div>
                </div>
            </div>

            <!-- Growth Metrics -->
            <div class="form-section">
                <h3>üìà Growth Metrics (25% Weight)</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Revenue Growth 3Y CAGR (%) *</label>
                        <input type="number" step="0.01" id="revenue_growth" placeholder="e.g., 26.95">
                        <span class="help-text">3-year compound annual growth rate</span>
                    </div>
                    <div class="form-group">
                        <label>EPS Growth 3Y CAGR (%) *</label>
                        <input type="number" step="0.01" id="eps_growth" placeholder="e.g., 352.93">
                    </div>
                    <div class="form-group">
                        <label>Free Cash Flow Growth (%) *</label>
                        <input type="number" step="0.01" id="fcf_growth" placeholder="e.g., 15.69">
                    </div>
                </div>
            </div>

            <!-- Valuation Metrics -->
            <div class="form-section">
                <h3>üíµ Valuation Metrics (20% Weight)</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>EPS (Rs.) *</label>
                        <input type="number" step="0.01" id="eps" placeholder="e.g., 2.45">
                    </div>
                    <div class="form-group">
                        <label>P/E Ratio</label>
                        <input type="number" step="0.01" id="pe_ratio" disabled>
                        <span class="help-text">Auto-calculated</span>
                    </div>
                    <div class="form-group">
                        <label>Book Value Per Share (Rs.) *</label>
                        <input type="number" step="0.01" id="bvps" placeholder="e.g., 37.10">
                    </div>
                    <div class="form-group">
                        <label>P/B Ratio</label>
                        <input type="number" step="0.01" id="pb_ratio" disabled>
                        <span class="help-text">Auto-calculated</span>
                    </div>
                    <div class="form-group">
                        <label>PEG Ratio</label>
                        <input type="number" step="0.01" id="peg_ratio" disabled>
                        <span class="help-text">Auto-calculated (P/E √∑ EPS Growth)</span>
                    </div>
                </div>
            </div>

            <!-- Efficiency Metrics -->
            <div class="form-section">
                <h3>‚öôÔ∏è Efficiency Metrics (10% Weight)</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Total Assets (Rs. Crores) *</label>
                        <input type="number" step="0.01" id="total_assets" placeholder="e.g., 37853">
                    </div>
                    <div class="form-group">
                        <label>Asset Turnover Ratio</label>
                        <input type="number" step="0.01" id="asset_turnover" disabled>
                        <span class="help-text">Auto-calculated (Revenue / Assets)</span>
                    </div>
                    <div class="form-group">
                        <label>Inventory Turnover Ratio *</label>
                        <input type="number" step="0.01" id="inventory_turnover" placeholder="e.g., 10.5 (or 999 for service companies)">
                        <span class="help-text">COGS / Inventory (999 for asset-light)</span>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="calculateScore()">üéØ Calculate Score</button>
                <button class="btn btn-secondary" onclick="clearAll()">üîÑ Clear All</button>
            </div>
        </div>

        <!-- RESULTS TAB -->
        <div id="results-tab" class="tab-content">
            <div class="results-container" id="results-display">
                <div class="alert alert-info">
                    <strong>‚ÑπÔ∏è No results yet.</strong> Please fill in the data in the "Input Data" tab and click "Calculate Score" to see results.
                </div>
            </div>
        </div>

        <!-- GUIDE TAB -->
        <div id="guide-tab" class="tab-content">
            <div class="form-section">
                <h3>üìñ How to Use This Tool</h3>
                <div style="line-height: 1.8;">
                    <h4 style="color: #667eea; margin-top: 20px;">Step 1: Enter Company Data</h4>
                    <p>Fill in all required fields marked with (*). You can use data from:</p>
                    <ul style="margin-left: 20px;">
                        <li>Screener.in (recommended)</li>
                        <li>MoneyControl</li>
                        <li>Company annual reports</li>
                        <li>BSE/NSE official filings</li>
                    </ul>

                    <h4 style="color: #667eea; margin-top: 20px;">Step 2: Auto-Calculations</h4>
                    <p>The following ratios are calculated automatically:</p>
                    <ul style="margin-left: 20px;">
                        <li>Debt-to-Equity = Total Debt √∑ Shareholders Equity</li>
                        <li>Current Ratio = Current Assets √∑ Current Liabilities</li>
                        <li>Interest Coverage = EBIT √∑ Interest Expense</li>
                        <li>Net Margin = Net Income √∑ Revenue √ó 100</li>
                        <li>P/E Ratio = Current Price √∑ EPS</li>
                        <li>P/B Ratio = Current Price √∑ Book Value Per Share</li>
                        <li>PEG Ratio = P/E √∑ EPS Growth Rate</li>
                        <li>Asset Turnover = Revenue √∑ Total Assets</li>
                    </ul>

                    <h4 style="color: #667eea; margin-top: 20px;">Step 3: Scoring Methodology</h4>
                    <p>The system evaluates 14 metrics across 5 categories:</p>
                    <ol style="margin-left: 20px;">
                        <li><strong>Financial Health (20%):</strong> Debt-to-Equity, Current Ratio, Interest Coverage</li>
                        <li><strong>Profitability (25%):</strong> ROE, ROIC, Net Profit Margin</li>
                        <li><strong>Growth (25%):</strong> Revenue Growth, EPS Growth, FCF Growth</li>
                        <li><strong>Valuation (20%):</strong> P/E Ratio, P/B Ratio, PEG Ratio</li>
                        <li><strong>Efficiency (10%):</strong> Asset Turnover, Inventory Turnover</li>
                    </ol>

                    <h4 style="color: #667eea; margin-top: 20px;">Score Interpretation</h4>
                    <ul style="margin-left: 20px;">
                        <li><strong>90-100:</strong> Excellent - Strong Buy</li>
                        <li><strong>75-89:</strong> Very Good - Buy</li>
                        <li><strong>60-74:</strong> Good - Buy/Hold</li>
                        <li><strong>40-59:</strong> Average - Hold/Caution</li>
                        <li><strong>Below 40:</strong> Poor - Avoid</li>
                    </ul>

                    <h4 style="color: #667eea; margin-top: 20px;">Tips for Best Results</h4>
                    <ul style="margin-left: 20px;">
                        <li>Use the most recent annual report data (FY 2024)</li>
                        <li>For growth rates, calculate 3-year CAGR manually if needed</li>
                        <li>Service companies can use 999 for inventory turnover</li>
                        <li>Double-check all numbers before submitting</li>
                        <li>Compare results with peer companies for context</li>
                    </ul>

                    <h4 style="color: #667eea; margin-top: 20px;">Example: Using Screener.in</h4>
                    <ol style="margin-left: 20px;">
                        <li>Visit https://www.screener.in/company/[SYMBOL]/</li>
                        <li>Balance Sheet section ‚Üí Copy latest year values</li>
                        <li>Profit & Loss section ‚Üí Copy revenue, profit, margins</li>
                        <li>Ratios section ‚Üí Use ROE, ROCE values</li>
                        <li>Top section ‚Üí Copy current price, EPS, P/E</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auto-calculate derived metrics
        function autoCalculate() {
            const debt = parseFloat(document.getElementById('total_debt').value) || 0;
            const equity = parseFloat(document.getElementById('equity').value) || 0;
            const currentAssets = parseFloat(document.getElementById('current_assets').value) || 0;
            const currentLiabilities = parseFloat(document.getElementById('current_liabilities').value) || 0;
            const ebit = parseFloat(document.getElementById('ebit').value) || 0;
            const interest = parseFloat(document.getElementById('interest').value) || 0;
            const netIncome = parseFloat(document.getElementById('net_income').value) || 0;
            const revenue = parseFloat(document.getElementById('revenue').value) || 0;
            const price = parseFloat(document.getElementById('current_price').value) || 0;
            const eps = parseFloat(document.getElementById('eps').value) || 0;
            const bvps = parseFloat(document.getElementById('bvps').value) || 0;
            const epsGrowth = parseFloat(document.getElementById('eps_growth').value) || 0;
            const totalAssets = parseFloat(document.getElementById('total_assets').value) || 0;

            // Debt-to-Equity
            if (equity > 0) {
                document.getElementById('debt_equity').value = (debt / equity).toFixed(4);
            }

            // Current Ratio
            if (currentLiabilities > 0) {
                document.getElementById('current_ratio').value = (currentAssets / currentLiabilities).toFixed(2);
            }

            // Interest Coverage
            if (interest > 0) {
                document.getElementById('interest_coverage').value = (ebit / interest).toFixed(2);
            }

            // Net Margin
            if (revenue > 0) {
                document.getElementById('net_margin').value = ((netIncome / revenue) * 100).toFixed(2);
            }

            // P/E Ratio
            if (eps > 0) {
                document.getElementById('pe_ratio').value = (price / eps).toFixed(2);
            }

            // P/B Ratio
            if (bvps > 0) {
                document.getElementById('pb_ratio').value = (price / bvps).toFixed(2);
            }

            // PEG Ratio
            const peRatio = price / eps;
            if (epsGrowth > 0 && eps > 0) {
                document.getElementById('peg_ratio').value = (peRatio / epsGrowth).toFixed(2);
            }

            // Asset Turnover
            if (totalAssets > 0) {
                document.getElementById('asset_turnover').value = (revenue / totalAssets).toFixed(2);
            }
        }

        // Add event listeners for auto-calculation
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input[type="number"]:not([disabled])');
            inputs.forEach(input => {
                input.addEventListener('input', autoCalculate);
            });
        });

        // Switch tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // Load template data
        function loadTemplate(template) {
            if (template === 'eternal') {
                // Eternal Ltd (Zomato) data
                document.getElementById('company_name').value = 'Eternal Ltd (Zomato Limited)';
                document.getElementById('symbol').value = 'ETERNAL';
                document.getElementById('current_price').value = '310.00';
                document.getElementById('sector').value = 'Consumer Services';
                
                document.getElementById('total_debt').value = '248';
                document.getElementById('equity').value = '35820';
                document.getElementById('current_assets').value = '36293';
                document.getElementById('current_liabilities').value = '1785';
                document.getElementById('ebit').value = '1297';
                document.getElementById('interest').value = '20';
                
                document.getElementById('net_income').value = '2362';
                document.getElementById('roe').value = '6.75';
                document.getElementById('roic').value = '13.00';
                document.getElementById('revenue').value = '9481';
                
                document.getElementById('revenue_growth').value = '26.95';
                document.getElementById('eps_growth').value = '352.93';
                document.getElementById('fcf_growth').value = '15.69';
                
                document.getElementById('eps').value = '2.45';
                document.getElementById('bvps').value = '37.10';
                
                document.getElementById('total_assets').value = '37853';
                document.getElementById('inventory_turnover').value = '999';
                
                autoCalculate();
                alert('‚úÖ Eternal Ltd data loaded successfully!');
            }
        }

        // Clear all fields
        function clearAll() {
            if (confirm('Are you sure you want to clear all fields?')) {
                document.querySelectorAll('input').forEach(input => input.value = '');
            }
        }

        // Normalize metric score
        function normalizeScore(metricName, value) {
            const configs = {
                'debt_to_equity': { direction: 'lower', ideal_min: 0.0, ideal_max: 0.5, acceptable_max: 2.0 },
                'current_ratio': { direction: 'higher', ideal_min: 1.5, ideal_max: 3.0, acceptable_min: 0.5 },
                'interest_coverage': { direction: 'higher', ideal_min: 5.0, ideal_max: 20.0, acceptable_min: 1.0 },
                'roe': { direction: 'higher', ideal_min: 15.0, ideal_max: 30.0, acceptable_min: 5.0 },
                'roic': { direction: 'higher', ideal_min: 15.0, ideal_max: 35.0, acceptable_min: 5.0 },
                'net_profit_margin': { direction: 'higher', ideal_min: 10.0, ideal_max: 25.0, acceptable_min: 3.0 },
                'revenue_growth_3y': { direction: 'higher', ideal_min: 15.0, ideal_max: 30.0, acceptable_min: 5.0 },
                'eps_growth_3y': { direction: 'higher', ideal_min: 15.0, ideal_max: 30.0, acceptable_min: 5.0 },
                'fcf_growth': { direction: 'higher', ideal_min: 10.0, ideal_max: 25.0, acceptable_min: 0.0 },
                'pe_ratio': { direction: 'lower', ideal_min: 10.0, ideal_max: 20.0, acceptable_max: 40.0 },
                'pb_ratio': { direction: 'lower', ideal_min: 1.0, ideal_max: 4.0, acceptable_max: 10.0 },
                'peg_ratio': { direction: 'lower', ideal_min: 0.5, ideal_max: 1.5, acceptable_max: 3.0 },
                'asset_turnover': { direction: 'higher', ideal_min: 1.0, ideal_max: 2.5, acceptable_min: 0.5 },
                'inventory_turnover': { direction: 'higher', ideal_min: 6.0, ideal_max: 12.0, acceptable_min: 2.0 }
            };

            const config = configs[metricName];
            if (!config) return { score: 0, rating: 'N/A' };

            let score = 0;
            let rating = '';

            // Handle very high inventory turnover (service companies)
            if (metricName === 'inventory_turnover' && value >= 999) {
                return { score: 100, rating: 'Excellent' };
            }

            if (config.direction === 'higher') {
                if (value >= config.ideal_max) {
                    score = 100;
                    rating = 'Excellent';
                } else if (value >= config.ideal_min) {
                    score = 80 + ((value - config.ideal_min) / (config.ideal_max - config.ideal_min)) * 20;
                    rating = 'Very Good';
                } else if (value >= config.acceptable_min) {
                    score = 40 + ((value - config.acceptable_min) / (config.ideal_min - config.acceptable_min)) * 40;
                    rating = score >= 60 ? 'Good' : 'Average';
                } else {
                    score = Math.max(0, (value / config.acceptable_min) * 40);
                    rating = score >= 20 ? 'Below Average' : 'Poor';
                }
            } else { // direction === 'lower'
                if (value <= config.ideal_min) {
                    score = 100;
                    rating = 'Excellent';
                } else if (value <= config.ideal_max) {
                    score = 80 + ((config.ideal_max - value) / (config.ideal_max - config.ideal_min)) * 20;
                    rating = 'Very Good';
                } else if (value <= config.acceptable_max) {
                    score = 40 + ((config.acceptable_max - value) / (config.acceptable_max - config.ideal_max)) * 40;
                    rating = score >= 60 ? 'Good' : 'Average';
                } else {
                    score = Math.max(0, 40 * (1 - (value - config.acceptable_max) / config.acceptable_max));
                    rating = score >= 20 ? 'Below Average' : 'Poor';
                }
            }

            score = Math.max(0, Math.min(100, score));
            return { score: score, rating: rating };
        }

        // Calculate final score
        function calculateScore() {
            // Validate required fields
            const required = [
                'company_name', 'symbol', 'current_price', 'total_debt', 'equity',
                'current_assets', 'current_liabilities', 'ebit', 'interest',
                'net_income', 'roe', 'roic', 'revenue', 'revenue_growth',
                'eps_growth', 'fcf_growth', 'eps', 'bvps', 'total_assets', 'inventory_turnover'
            ];

            let missingFields = [];
            required.forEach(field => {
                if (!document.getElementById(field).value) {
                    missingFields.push(field.replace(/_/g, ' ').toUpperCase());
                }
            });

            if (missingFields.length > 0) {
                alert('‚ùå Please fill in all required fields:\n\n' + missingFields.join('\n'));
                return;
            }

            // Get all values
            const metrics = {
                debt_to_equity: parseFloat(document.getElementById('debt_equity').value),
                current_ratio: parseFloat(document.getElementById('current_ratio').value),
                interest_coverage: parseFloat(document.getElementById('interest_coverage').value),
                roe: parseFloat(document.getElementById('roe').value),
                roic: parseFloat(document.getElementById('roic').value),
                net_profit_margin: parseFloat(document.getElementById('net_margin').value),
                revenue_growth_3y: parseFloat(document.getElementById('revenue_growth').value),
                eps_growth_3y: parseFloat(document.getElementById('eps_growth').value),
                fcf_growth: parseFloat(document.getElementById('fcf_growth').value),
                pe_ratio: parseFloat(document.getElementById('pe_ratio').value),
                pb_ratio: parseFloat(document.getElementById('pb_ratio').value),
                peg_ratio: parseFloat(document.getElementById('peg_ratio').value),
                asset_turnover: parseFloat(document.getElementById('asset_turnover').value),
                inventory_turnover: parseFloat(document.getElementById('inventory_turnover').value)
            };

            const weights = {
                debt_to_equity: 0.07,
                current_ratio: 0.07,
                interest_coverage: 0.06,
                roe: 0.08,
                roic: 0.09,
                net_profit_margin: 0.08,
                revenue_growth_3y: 0.10,
                eps_growth_3y: 0.10,
                fcf_growth: 0.05,
                pe_ratio: 0.07,
                pb_ratio: 0.07,
                peg_ratio: 0.06,
                asset_turnover: 0.05,
                inventory_turnover: 0.05
            };

            const metricNames = {
                debt_to_equity: 'Debt-to-Equity',
                current_ratio: 'Current Ratio',
                interest_coverage: 'Interest Coverage',
                roe: 'ROE',
                roic: 'ROIC',
                net_profit_margin: 'Net Profit Margin',
                revenue_growth_3y: 'Revenue Growth (3Y)',
                eps_growth_3y: 'EPS Growth (3Y)',
                fcf_growth: 'FCF Growth',
                pe_ratio: 'P/E Ratio',
                pb_ratio: 'P/B Ratio',
                peg_ratio: 'PEG Ratio',
                asset_turnover: 'Asset Turnover',
                inventory_turnover: 'Inventory Turnover'
            };

            const categories = {
                'Financial Health': ['debt_to_equity', 'current_ratio', 'interest_coverage'],
                'Profitability': ['roe', 'roic', 'net_profit_margin'],
                'Growth': ['revenue_growth_3y', 'eps_growth_3y', 'fcf_growth'],
                'Valuation': ['pe_ratio', 'pb_ratio', 'peg_ratio'],
                'Efficiency': ['asset_turnover', 'inventory_turnover']
            };

            // Calculate scores
            let totalScore = 0;
            let results = {};
            let categoryScores = {};

            Object.keys(metrics).forEach(key => {
                const normalized = normalizeScore(key, metrics[key]);
                const contribution = normalized.score * weights[key];
                totalScore += contribution;

                results[key] = {
                    value: metrics[key],
                    score: normalized.score,
                    rating: normalized.rating,
                    weight: weights[key],
                    contribution: contribution
                };
            });

            // Calculate category scores
            Object.keys(categories).forEach(category => {
                let catScore = 0;
                let catWeight = 0;
                categories[category].forEach(metric => {
                    catScore += results[metric].contribution;
                    catWeight += weights[metric];
                });
                categoryScores[category] = {
                    score: catScore,
                    weight: catWeight,
                    percentage: (catScore / catWeight) * 100
                };
            });

            // Display results
            displayResults(totalScore, results, categoryScores, metricNames, categories);
            
            // Switch to results tab
            document.querySelectorAll('.tab').forEach((tab, index) => {
                if (index === 1) tab.click();
            });
        }

        function displayResults(totalScore, results, categoryScores, metricNames, categories) {
            let rating = '';
            if (totalScore >= 90) rating = 'Excellent - Strong Buy';
            else if (totalScore >= 75) rating = 'Very Good - Buy';
            else if (totalScore >= 60) rating = 'Good - Buy/Hold';
            else if (totalScore >= 40) rating = 'Average - Hold/Caution';
            else rating = 'Poor - Avoid';

            const companyName = document.getElementById('company_name').value;
            const symbol = document.getElementById('symbol').value;

            let html = `
                <div class="score-card">
                    <h2>${companyName} (${symbol})</h2>
                    <div class="score-value">${totalScore.toFixed(2)}<span style="font-size: 0.5em;">/100</span></div>
                    <div class="score-rating">${rating}</div>
                    <p style="margin-top: 20px; font-size: 1.1em;">Analysis Date: ${new Date().toLocaleDateString('en-IN')}</p>
                </div>

                <div class="category-breakdown">
                    <h3>üìä Category Breakdown</h3>
            `;

            Object.keys(categoryScores).forEach(category => {
                const cat = categoryScores[category];
                html += `
                    <div class="category-item">
                        <div>
                            <div class="category-name">${category}</div>
                            <div style="font-size: 0.9em; color: #6c757d;">Weight: ${(cat.weight * 100).toFixed(0)}%</div>
                        </div>
                        <div>
                            <div class="category-score">${cat.score.toFixed(2)}/${(cat.weight * 100).toFixed(0)}</div>
                            <div style="font-size: 0.85em; color: #6c757d;">${cat.percentage.toFixed(1)}% of max</div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${cat.percentage}%"></div>
                    </div>
                `;
            });

            html += '</div><div class="metrics-grid">';

            Object.keys(results).forEach(key => {
                const metric = results[key];
                const name = metricNames[key];
                
                let scoreClass = '';
                if (metric.score >= 80) scoreClass = 'score-excellent';
                else if (metric.score >= 60) scoreClass = 'score-good';
                else if (metric.score >= 40) scoreClass = 'score-average';
                else scoreClass = 'score-poor';

                html += `
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-name">${name}</div>
                            <div class="metric-score ${scoreClass}">${metric.score.toFixed(1)}</div>
                        </div>
                        <div class="metric-details">
                            <div class="metric-detail">
                                <span class="metric-detail-label">Raw Value</span>
                                <span class="metric-detail-value">${metric.value.toFixed(2)}</span>
                            </div>
                            <div class="metric-detail">
                                <span class="metric-detail-label">Rating</span>
                                <span class="metric-detail-value">${metric.rating}</span>
                            </div>
                            <div class="metric-detail">
                                <span class="metric-detail-label">Weight</span>
                                <span class="metric-detail-value">${(metric.weight * 100).toFixed(0)}%</span>
                            </div>
                            <div class="metric-detail">
                                <span class="metric-detail-label">Contribution</span>
                                <span class="metric-detail-value">${metric.contribution.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';

            html += `
                <div class="export-section">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üì• Export Results</h3>
                    <button class="btn btn-success" onclick="exportToCSV()">Download as CSV</button>
                    <button class="btn btn-primary" onclick="window.print()">Print Report</button>
                </div>
            `;

            document.getElementById('results-display').innerHTML = html;
        }

        function exportToCSV() {
            const companyName = document.getElementById('company_name').value;
            const symbol = document.getElementById('symbol').value;
            
            let csv = 'Fundamental Analysis Report\n';
            csv += `Company,${companyName}\n`;
            csv += `Symbol,${symbol}\n`;
            csv += `Date,${new Date().toLocaleDateString('en-IN')}\n\n`;
            
            csv += 'Metric,Raw Value,Normalized Score,Weight,Contribution,Rating\n';
            
            const metrics = document.querySelectorAll('.metric-card');
            metrics.forEach(card => {
                const name = card.querySelector('.metric-name').textContent;
                const details = card.querySelectorAll('.metric-detail-value');
                const score = card.querySelector('.metric-score').textContent;
                
                csv += `${name},${details[0].textContent},${score},${details[2].textContent},${details[3].textContent},${details[1].textContent}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', `${symbol}_analysis_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            alert('‚úÖ CSV file downloaded successfully!');
        }
    </script>
</body>
</html>
